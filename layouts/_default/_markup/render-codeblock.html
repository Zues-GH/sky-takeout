<!-- 
  代码块组件
  参数说明：
  - fold: 控制折叠行为（true/false/"disable"）
  - title: 代码块标题
  - lang: 覆盖自动检测的语言
  - hide: 隐藏语言显示
  - force: 强制使用指定语言
-->

<!-- 获取默认折叠模式（默认为true即折叠） -->
{{ $defaultFoldMod := .Page.Param "codeBlockFoldMode" | default true }}

<!-- 获取代码语言和标题 -->
{{- $lang := .Type | default "text" }}
{{- $title := .Attributes.title | default "" }}
{{- $u_lang := .Attributes.lang | default "" }}
{{- $hideLang := .Attributes.hide | default false }}
{{ $foldMode := .Attributes.fold | default $defaultFoldMod }}

<!-- 处理强制语言设置 -->
{{- if and (.Attributes.force) (ne $u_lang "") }}
{{- $lang = $u_lang }}
{{- end }}

<!-- 计算代码行数并判断是否为短代码（6行及以下） -->
{{ $lineCount := len (split .Inner "\n") }}
{{ $isShortCode := le $lineCount 6 }}

<!-- 主容器 
  class说明：
  - pe-code-details: 可折叠代码块
  - open: 展开状态
  - short-code: 短代码（不折叠）
  - scrollable: 可滚动
-->
<div class="pe-code-block-wrap 
    {{ if and (ne $foldMode "disable") (not $isShortCode) }} pe-code-details {{ end }}
    {{ if not $foldMode }} open {{ end }}
    {{ if $isShortCode }} short-code {{ end }}
    scrollable">
    
    <!-- 代码块头部 -->
    <div class="pe-code-block-header pe-code-details-summary">
        <!-- 左侧：语言显示 -->
        <div class="pe-code-block-header-left">
            {{ if not $hideLang }}
            <span>
                {{- if ne $u_lang "" }}
                {{- $u_lang -}}
                {{- else }}{{- $lang -}}{{- end }}
            </span>
            {{ end }}
        </div>
        
        <!-- 中间：标题显示 -->
        <div class="pe-code-block-header-center">
            <span>
                {{- if ne $title "" }}
                {{- $title }}
                {{ end }}
            </span>
        </div>
        
        <!-- 右侧：操作按钮 -->
        <div class="pe-code-block-header-right">
            <!-- 折叠按钮（仅当不是短代码且未禁用折叠时显示） -->
            {{ if and (ne $foldMode "disable") (not $isShortCode) }}
            <i class="arrow fas fa-chevron-down fa-fw pe-code-details-icon" aria-hidden="true"></i>
            {{ end }}
            
            <!-- 复制按钮 -->
            <button class="pe-code-copy-button" aria-label="复制代码">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" class="pe-icon">
                    <path fill="currentColor" fill-rule="evenodd" d="M7 5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-2v2a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h2zm2 2h5a3 3 0 0 1 3 3v5h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1zM5 9a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1z" clip-rule="evenodd"></path>
                </svg>
            </button>
        </div>
    </div>
    
    <!-- 代码内容区域 -->
    <div class="pe-code-details-content scrollable">
        {{ highlight .Inner $lang .Options }}
    </div>
</div>